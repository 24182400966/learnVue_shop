(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["users"],{"1bab":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("cebe"),s=r.n(a),i=r("1af2"),n=r.n(i);function o(e){var t=s.a.create({baseURL:"http://timemeetyou.com:8889/api/private/v1",timeout:5e3});return t.interceptors.request.use((function(e){return n.a.start(),e.headers.Authorization=window.sessionStorage.getItem("token"),e}),(function(e){})),t.interceptors.response.use((function(e){return n.a.done(),e}),(function(e){})),t(e)}},dc02:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"users"},[r("users-breadcrumb"),r("el-card",{staticClass:"box-card"},[r("users-func",{on:{queryClick:e.queryClick}}),r("el-table",{attrs:{data:e.usersList,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index"}}),r("el-table-column",{attrs:{prop:"username",label:"用户名"}}),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),r("el-table-column",{attrs:{prop:"mobile",label:"电话"}}),r("el-table-column",{attrs:{prop:"role_name",label:"角色"}}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{on:{change:function(r){return e.changeRowStateListen(t.row)}},model:{value:t.row.mg_state,callback:function(r){e.$set(t.row,"mg_state",r)},expression:"scope.row.mg_state"}})]}}])}),r("el-table-column",{attrs:{label:"操作",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(r){return e.update(t.row.id)}}}),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(r){return e.deleteUser(t.row.id)}}}),r("el-tooltip",{attrs:{effect:"dark",content:"分配角色",placement:"top",enterable:!1}},[r("el-button",{attrs:{type:"warning",icon:"el-icon-setting",size:"mini"}})],1)]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageNum,"page-sizes":[1,2,5,10],"page-size":10,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"修改用户",visible:e.updateUserVisible,width:"60%"},on:{"update:visible":function(t){e.updateUserVisible=t},close:e.updateUserClose}},[r("el-form",{ref:"updateUserForm",attrs:{model:e.updateUserForm,rules:e.updateUserrules,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{attrs:{disabled:""},model:{value:e.updateUserForm.username,callback:function(t){e.$set(e.updateUserForm,"username",t)},expression:"updateUserForm.username"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.updateUserForm.email,callback:function(t){e.$set(e.updateUserForm,"email",t)},expression:"updateUserForm.email"}})],1),r("el-form-item",{attrs:{label:"电话",prop:"mobile"}},[r("el-input",{model:{value:e.updateUserForm.mobile,callback:function(t){e.$set(e.updateUserForm,"mobile",t)},expression:"updateUserForm.mobile"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.updateUserVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.updateUser}},[e._v("确 定")])],1)],1)],1)},s=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),r("el-breadcrumb-item",[e._v("用户管理")]),r("el-breadcrumb-item",[e._v("用户列表")])],1)},n=[],o={name:"Breadcrumb"},l=o,u=r("2877"),d=Object(u["a"])(l,i,n,!1,null,"84132084",null),c=d.exports,m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.queryClick},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.queryClick},slot:"append"})],1)],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"primary"},on:{click:e.addUserClick}},[e._v("添加用户")])],1),r("add-user-dialog",{ref:"addUserDialog"})],1)},p=[],f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"添加用户",visible:e.addUserVisible,width:"60%"},on:{"update:visible":function(t){e.addUserVisible=t},close:e.addUserCancel}},[r("el-form",{ref:"addUserForm",attrs:{model:e.addUserForm,rules:e.addUserrules,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password"},model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1),r("el-form-item",{attrs:{label:"电话",prop:"mobile"}},[r("el-input",{model:{value:e.addUserForm.mobile,callback:function(t){e.$set(e.addUserForm,"mobile",t)},expression:"addUserForm.mobile"}})],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.addUserCancel}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1)},b=[],g=r("1bab");function h(e,t,r){return Object(g["a"])({url:"/users",method:"get",params:{query:r,pagenum:e,pagesize:t}})}function U(e,t){return Object(g["a"])({url:"users/"+e+"/state/"+t,method:"put"})}function v(e,t,r,a){return Object(g["a"])({url:"users",method:"post",data:{username:e,password:t,email:r,mobile:a}})}function F(e){return Object(g["a"])({url:"users/"+e,method:"get"})}function w(e,t,r){return Object(g["a"])({url:"users/"+e,method:"put",data:{email:t,mobile:r}})}function k(e){return Object(g["a"])({url:"users/"+e,method:"delete"})}var $={name:"addUserDialog",data:function(){var e=function(e,t,r){var a=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;if(a.test(t))return r();r(new Error("请输入一个合法的邮箱地址"))},t=function(e,t,r){var a=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;if(a.test(t))return r();r(new Error("请输入一个合法的手机号码"))};return{addUserVisible:!1,addUserForm:{username:"",password:"",email:"",mobile:""},addUserrules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:10,message:"长度在 3 到 10 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:16,message:"长度在 6 到 16 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:e,trigger:"blur"}],mobile:[{required:!0,message:"请输入电话号码",trigger:"blur"},{validator:t,trigger:"blur"}]}}},methods:{addUserClick:function(){this.addUserVisible=!0},addUserCancel:function(){this.addUserVisible=!1,this.$refs.addUserForm.resetFields()},addUser:function(){var e=this;this.$refs.addUserForm.validate((function(t){if(!t)return!1;e.addUserPost(e.addUserForm.username,e.addUserForm.password,e.addUserForm.email,e.addUserForm.mobile),e.addUserVisible=!1}))},addUserPost:function(e,t,r,a){var s=this;v(e,t,r,a).then((function(e){if(201!==e.data.meta.status)return s.$message.error(e.data.meta.msg);s.$message.success(e.data.meta.msg),s.$bus.$emit("freshClick")})).catch((function(e){}))}}},y=$,_=Object(u["a"])(y,f,b,!1,null,"34632072",null),C=_.exports,q={name:"UsersFunc",components:{AddUserDialog:C},data:function(){return{query:"",addUserVisible:!1}},methods:{queryClick:function(){this.$emit("queryClick",this.query)},addUserClick:function(){this.$refs.addUserDialog.addUserClick()}}},x=q,z=Object(u["a"])(x,m,p,!1,null,"21adb386",null),S=z.exports,L={name:"Users",components:{UsersBreadcrumb:c,UsersFunc:S},data:function(){var e=function(e,t,r){var a=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;if(a.test(t))return r();r(new Error("请输入一个合法的邮箱地址"))},t=function(e,t,r){var a=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;if(a.test(t))return r();r(new Error("请输入一个合法的手机号码"))};return{usersList:[],query:"",pageNum:1,pageSize:10,total:0,updateUserVisible:!1,updateUserForm:{id:"",username:"",email:"",mobile:""},updateUserrules:{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:e,trigger:"blur"}],mobile:[{required:!0,message:"请输入电话号码",trigger:"blur"},{validator:t,trigger:"blur"}]}}},created:function(){var e=this;this.getUsersList(),this.$bus.$on("freshClick",(function(){e.getUsersList()}))},beforeDestroy:function(){this.$bus.$off("freshClick")},methods:{handleSizeChange:function(e){this.pageSize=e,this.getUsersList()},handleCurrentChange:function(e){this.pageNum=e,this.getUsersList()},changeRowStateListen:function(e){this.changeRowState(e)},update:function(e){this.getUserFromId(e),this.updateUserVisible=!0},deleteUser:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteUserById(e)})).catch((function(){t.$message.info("已取消删除")}))},queryClick:function(e){this.query=e,this.pageNum=1,this.pageSize=10,this.getUsersList(1,10)},updateUserClose:function(){this.$refs.updateUserForm.resetFields()},updateUser:function(){var e=this;this.$refs.updateUserForm.validate((function(t){if(!t)return!1;e.updateUserSub(e.updateUserForm.id,e.updateUserForm.email,e.updateUserForm.mobile)}))},changeRowState:function(e){var t=this;U(e.id,e.mg_state).then((function(r){if(200!==r.data.meta.status)return e.mg_state=!e.mg_state,t.$message.error(r.data.meta.msg);t.$message.success(r.data.meta.msg)})).catch((function(e){}))},updateUserSub:function(e,t,r){var a=this;w(e,t,r).then((function(e){if(200!==e.data.meta.status)return a.$message.error(e.data.meta.msg);a.$message.success(e.data.meta.msg),a.updateUserVisible=!1,a.getUsersList()})).catch((function(e){}))},getUsersList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pageNum,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pageSize,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.query;h(t,r,a).then((function(t){if(200!==t.data.meta.status)return e.$message.error(t.data.meta.msg);e.usersList=t.data.data.users,e.total=t.data.data.total})).catch((function(e){}))},deleteUserById:function(e){var t=this;k(e).then((function(e){if(200!==e.data.meta.status)return t.$message.error(e.data.meta.msg);t.$message.success(e.data.meta.msg),t.getUsersList()})).catch((function(e){}))},getUserFromId:function(e){var t=this;F(e).then((function(e){t.updateUserForm=e.data.data})).catch((function(e){}))}}},V=L,j=Object(u["a"])(V,a,s,!1,null,"2f376048",null);t["default"]=j.exports}}]);
//# sourceMappingURL=users.5e5dd46d.js.map